const tracker=function(e){let r="https://collecter.frontjs.com/",t="tracker_es.min.js",n="1.0.0-rc.2",o=5e3,i=1,a=256,l=1024,s={};const c=function(e,r){r=r||"";let t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))},u=function(e){return e&&e.match(/^\w{32}$/)?0:1},f=function(e){return e<=(14|i)?0:1},g=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},p=function(e){for(var r in e=e||{})if("object"==typeof e[r])return r;return 0},d=wx.getSystemInfoSync(),m={unknown:0,none:1,wifi:3,"2g":4,"3g":5,"4g":6};let h=null,v=null,y=null,w=0,D=null,S=[/\[(\d|\s|:|-)*\]\s*request\s+(begin|success|fail)/g];const b={KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]?r.push(e[t]):r.push(new RegExp(e[t].source,e[t].flag));return r},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r=b.getTime().toString(16);for(r="0"+r;r.length<16;)r="f"+r;for(;r.length<32;)r+=e[Math.floor(16*Math.random())];return r},stringifyParameter:function(e){var r=[];if(e&&e.length){for(var t=0;t<e.length;t++)if(null===e[t])r.push("null");else if(void 0===e[t])r.push("undefined");else if(e[t]instanceof Array&&"string"==typeof e[t].toString())r.push("["+e[t].toString()+"]");else if("object"==typeof e[t]){var n=[];for(var o in e[t]){var i="";if(i+=o+": ",null===e[t][o])i+="null";else if(void 0===e[t][o])i+="undefined";else{switch(typeof e[t][o]){case"object":e[t][o]instanceof Array&&"string"==typeof e[t][o].toString()?i+="["+e[t][o].toString()+"]":"string"==typeof e[t][o].valueOf()?i+=e[t][o].toString():"string"==typeof e[t][o].toString()?i+=e[t][o].toString():i+="[object]";break;case"function":i+="[function]";break;default:i+=e[t][o].toString()}}n.push(i)}r.push("{"+n.join(", ")+"}")}else"string"==typeof e[t].valueOf()?r.push(e[t].valueOf()):"string"==typeof e[t].toString()?r.push(e[t].toString()):r.push("[object]");return r.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\\n).)*"+b.addSlashes(t)+".*\\n","g");return e.replace(r,"")},getUserAgent:function(){return"N/A"},getCurrentURL:function(){return v},getRefererURL:function(){return h},getViewPortSize:function(){return{w:d.windowWidth,h:d.windowHeight,r:d.pixelRatio}},getClientID:function(){return wx.getStorageSync("frontjs:client:id")||wx.setStorageSync("frontjs:client:id",b.getGUID()),wx.getStorageSync("frontjs:client:id")},getSessionID:function(){return y||(y=b.getGUID()),y},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)""!==r[n]&&e.match(r[n])&&(t|=!0);return!t}return!1},checkIgnorePattern:function(e){if(e)for(var r=0;r<S.length;r++)if(e.match(S[r]))return!0;return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,i){return i=i&&i.stack?i.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:i=b.filterTrace(i)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t,n=null){return n?{message:e,detail:{tagname:r,resourceURL:t,response:n.response}}:{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}};let k=function(e){var n={},o=!0;if(u(e.token)?(c(1001),o&=!1):n.token=e.token.toString(),f(e.behaviour)?(c(1002),o&=!1):(n.behaviour=parseInt(e.behaviour),n.behaviour||(n.behaviour=14|i)),g(e.origin)){var a=g(e.behaviour);c(1003,a),o&=!1}else n.origin=b.uriArrayCopy(e.origin),n.origin.push(/^((?!:\/\/).)*$/),n.origin.push(t),n.origin.push(r);return g(e.exclude)?(a=g(e.exclude),c(1004,a),o&=!1):(n.exclude=b.uriArrayCopy(e.exclude),n.exclude.push(t),n.exclude.push(r)),p(e.userData)?(a=p(e.userData),c(1005,a),o&=!1):n.userData=b.KVArrayCopy(e.userData),!!o&&n}(e);if(!k)return c(4e3),!1;(s={}).brand=d.brand,s.model=d.model,s.osType=d.platform,s.osversion=d.system,s.deviceID=b.getClientID(),s.freeDiskSpace=null,s.freeRam=null,s.isRoot=null,s.isPortrait=null,s.name=null,s.network=null,wx.getNetworkType({success:function(e){s.network=m[e.networkType]}}),wx.onNetworkStatusChange(function(e){s.network=m[e.networkType]});let R={request:function(e){let r=e[0].success,t=e[0].fail,n=b.getTime(),o=0;e[0].success=function(){o=b.getTime();let t=b.composeXHRErrorData(771,e[0].url,{status:arguments[0].statusCode},{send:0,load:o-n,total:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&P(768,t),r&&r.apply(this,[].slice.call(arguments))},e[0].fail=function(){o=b.getTime();let r=b.composeXHRErrorData(769,e[0].url,{status:0},{send:o-n,load:0,total:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&P(768,r),t&&t.apply(this,[].slice.call(arguments))}},downloadFile:function(e){let r=e[0].success,t=e[0].fail,n=b.getTime(),o=0;e[0].success=function(){o=b.getTime();let t=b.composeResourceErrorData(515,"wx.downloadFile",e[0].url,{response:o-n});b.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&P(512,t),r&&r.apply(this,[].slice.call(arguments))},e[0].fail=function(){let r=b.composeResourceErrorData(513,"wx.downloadFile",e[0].url);b.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&P(512,r),t&&t.apply(this,[].slice.call(arguments))}}};if(wx.tracker)return c(4001),null;{let e=wx,r={};for(var x in wx)if(R[x]){let t=x.toString();r[t]=function(){return R[t](arguments),e[t].apply(e,[].slice.call(arguments))}}else r[x]=e[x];r.tracker=!0,wx=r}let T=Page;Page=function(){let e=arguments,r=e[0].onShow,t=e[0].onHide;e[0].onShow=function(){let e=getCurrentPages();h=v,v=e.length>0?e[e.length-1].route:"",w=b.getTime(),r&&r.apply(this,[].slice.call(arguments)),D=b.getGUID();let t=b.composePerformaceData(l,{view:0});P(l,t)},e[0].onHide=function(){let e=b.getTime()-w,r=b.composePerformaceData(l,{view:e});P(l,r),t&&t.apply(this,[].slice.call(arguments))},T.apply(null,[].slice.call(arguments))};let I=App;if(App=function(){let e=arguments,r=e[0].onError;e[0].onError=function(){L.catch(arguments[0]),r&&r.apply(this,[].slice.call(arguments))},e[0].FrontJS=F,I.apply(null,[].slice.call(arguments))},console){var U=console.log,C=console.warn,E=console.error;console.log=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=b.composeScriptErrorData(257,b.stringifyParameter(e).substr(0,1e3),"via console.log",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&i&&P(a,r),U.apply(console,e)},console.warn=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=b.composeScriptErrorData(258,b.stringifyParameter(e).substr(0,1e3),"via console.warn",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&i&&P(a,r),C.apply(console,e)},console.error=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=b.composeScriptErrorData(259,b.stringifyParameter(e).substr(0,1e3),"via console.error",0,0,new Error(b.stringifyParameter(e).substr(0,1e3)));k.behaviour&i&&P(a,r),E.apply(console,e)}}function P(e,r){var t=!1,o=b.composeTrackerData(e,r);o.currentURL=b.getCurrentURL(),o.refererURL=b.getRefererURL(),o.currentRoute=o.currentURL,o.refererRoute=o.refererURL,o.viewPort=b.getViewPortSize(),o.userAgent=b.getUserAgent(),o.clientID=b.getClientID(),o.sessionID=b.getSessionID(),e===l?(o.messageID=D,t=!0):o.messageID=b.getGUID(),o.token=k.token,o.version=n,o.userData=k.userData,o.deviceData=s,setTimeout(function(){A(o,t)},0)}var _=[],j=null;function A(e,t){e&&_.push(e),t&&_.length&&(wx.request({url:r,data:_,method:"POST"}),_=[],clearTimeout(j),O())}function O(){j=setTimeout(function(){A(null,!0),O()},o)}O();let L=function(e){function r(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,function(e){if(!e.message)return!0;var r=b.composeScriptErrorData(a,e.message,e.filename,e.lineno,e.colno,e.error);b.checkCrossOrigin(e.filename,k.exclude)&&k.behaviour&i&&P(a,r)}(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return r(e)}},catch:r,composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return r(e)}}},addUserData:function(r,t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t?(e.userData[r]=t,!0):(c(1005,r),!1)},removeUserData:function(r){return delete e.userData[r],!0}}}(k);const F={C:{SCRIPT:i,RESOURCE:2,XHR:4,PERFOMACE:8},V:n,try:L.try,catch:L.catch,composedTry:L.composedTry,addUserData:L.addUserData,removeUserData:L.removeUserData};return F};export default tracker;
//# sourceMappingURL=tracker_es.min.js.map